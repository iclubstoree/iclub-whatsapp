<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>CONTROLE ICLUB SA√çDAS</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary-color: #8b5cf6;
      --secondary-color: #a855f7;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --danger-color: #ef4444;
      --dark-color: #1f2937;
      --light-bg: #f8fafc;
      --white: #ffffff;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      --whatsapp-green: #25d366;
      --whatsapp-dark: #128c7e;
    }

    body {
      background: #ffffff;
      min-height: 100vh;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    .main-container {
      background: var(--white);
      border-radius: 20px;
      box-shadow: var(--shadow-lg);
      margin: 20px auto;
      padding: 30px;
      max-width: 1400px;
    }

    .header-title {
      color: #10b981;
      font-weight: 800;
      font-size: 2rem;
      margin-bottom: 30px;
      text-align: center;
    }

    /* ===== CHAT IA STYLES MELHORADO ===== */
    .chat-ia-container {
      background: linear-gradient(135deg, var(--whatsapp-green), var(--whatsapp-dark));
      border-radius: 16px;
      padding: 15px;
      margin-bottom: 25px;
      color: white;
      box-shadow: var(--shadow-lg);
      transition: all 0.3s ease;
    }

    .chat-header {
      display: flex;
      align-items: center;
      gap: 15px;
      padding-bottom: 10px;
    }

    .chat-header:hover {
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 10px;
      margin: -10px;
    }

    .chat-avatar {
      width: 45px;
      height: 45px;
      background: rgba(255,255,255,0.25);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .chat-title {
      flex: 1;
    }

    .chat-title h5 {
      margin: 0;
      font-weight: 700;
      font-size: 1.2rem;
    }

    .chat-title small {
      opacity: 0.9;
      font-size: 0.85rem;
      display: block;
      margin-top: 2px;
    }

    .chat-messages {
      background: rgba(255,255,255,0.15);
      border-radius: 12px;
      padding: 15px;
      height: 180px;
      overflow-y: auto;
      margin-bottom: 15px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.2);
    }

    .chat-message {
      margin-bottom: 12px;
      display: flex;
      gap: 10px;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .chat-message.user {
      justify-content: flex-end;
    }

    .chat-message.system {
      justify-content: flex-start;
    }

    .chat-bubble {
      max-width: 85%;
      padding: 12px 16px;
      border-radius: 18px;
      word-wrap: break-word;
      position: relative;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .chat-message.user .chat-bubble {
      background: #ffffff;
      color: var(--dark-color);
      border-bottom-right-radius: 6px;
    }

    .chat-message.system .chat-bubble {
      background: rgba(255,255,255,0.25);
      color: white;
      border-bottom-left-radius: 6px;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .chat-time {
      font-size: 0.7rem;
      opacity: 0.7;
      margin-top: 4px;
      text-align: right;
    }

    .chat-input-container {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 12px;
    }

    .chat-input {
      flex: 1;
      background: rgba(255,255,255,0.25);
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 25px;
      padding: 12px 20px;
      color: white;
      font-size: 0.95rem;
      transition: all 0.2s ease;
    }

    .chat-input::placeholder {
      color: rgba(255,255,255,0.8);
    }

    .chat-input:focus {
      outline: none;
      border-color: rgba(255,255,255,0.6);
      background: rgba(255,255,255,0.3);
      box-shadow: 0 0 0 3px rgba(255,255,255,0.1);
    }

    .chat-send-btn {
      background: rgba(255,255,255,0.25);
      border: none;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      color: white;
      font-size: 1.2rem;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .chat-send-btn:hover:not(:disabled) {
      background: rgba(255,255,255,0.4);
      transform: scale(1.05);
    }

    .chat-send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .chat-examples {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .chat-example-btn {
      background: rgba(255,255,255,0.2);
      border: 1px solid rgba(255,255,255,0.3);
      border-radius: 20px;
      padding: 8px 14px;
      color: white;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }

    .chat-example-btn:hover {
      background: rgba(255,255,255,0.35);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .typing-indicator {
      display: none;
      padding: 10px 16px;
      background: rgba(255,255,255,0.2);
      border-radius: 18px;
      color: white;
      font-style: italic;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .typing-dots {
      display: flex;
      gap: 4px;
    }

    .typing-dots span {
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      animation: typing 1.4s infinite ease-in-out;
    }

    .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
    .typing-dots span:nth-child(2) { animation-delay: -0.16s; }

    @keyframes typing {
      0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
      40% { transform: scale(1); opacity: 1; }
    }

    /* Anima√ß√£o para status Firebase */
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }

    .status-online {
      background: #10b981 !important;
      animation: none !important;
    }

    .status-offline {
      background: #6b7280 !important;
      animation: none !important;
    }

    .status-error {
      background: #ef4444 !important;
      animation: pulse 1s infinite !important;
    }

    /* ===== EXISTING STYLES ===== */
    .card-modern {
      background: var(--white);
      border-radius: 16px;
      box-shadow: var(--shadow);
      border: none;
      padding: 25px;
      margin-bottom: 25px;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .card-modern:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .form-control, .form-select {
      border-radius: 12px;
      border: 2px solid #e5e7eb;
      padding: 12px 16px;
      transition: all 0.2s ease;
      background: var(--light-bg);
    }

    .form-control:focus, .form-select:focus {
      border-color: var(--success-color);
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
      background: var(--white);
    }

    .btn-modern {
      border-radius: 12px;
      padding: 12px 24px;
      font-weight: 600;
      transition: all 0.2s ease;
      border: none;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-size: 0.85rem;
    }

    .btn-primary-modern {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: white;
    }

    .btn-primary-modern:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 15px rgba(99, 102, 241, 0.3);
    }

    .btn-success-modern {
      background: linear-gradient(135deg, var(--success-color), #059669);
      color: white;
    }

    .btn-success-modern:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 15px rgba(16, 185, 129, 0.3);
    }

    .btn-sm-modern {
      padding: 8px 16px;
      font-size: 0.75rem;
      border-radius: 8px;
    }

    .status-section {
      background: var(--light-bg);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      border-left: 4px solid;
    }

    .status-atrasadas { border-left-color: var(--danger-color); }
    .status-vencendo { border-left-color: var(--warning-color); }
    .status-proximas { border-left-color: #f97316; }
    .status-recorrentes { border-left-color: var(--success-color); }

    .status-title {
      background: linear-gradient(135deg, var(--success-color), #059669);
      color: white;
      font-weight: 700;
      font-size: 1.1rem;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);
    }

    .table-modern {
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--shadow);
      border: none;
    }

    .table-modern thead {
      background: linear-gradient(135deg, var(--success-color), #059669);
      color: white;
    }

    .table-modern th {
      border: none;
      padding: 16px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-size: 0.85rem;
      text-align: center;
    }

    .table-modern td {
      border: none;
      padding: 16px;
      vertical-align: middle;
      border-bottom: 1px solid #f1f5f9;
      text-align: center;
    }

    .table-modern tbody tr:hover {
      background: var(--light-bg);
      transition: background 0.2s ease;
    }

    .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .dashboard-card {
      background: var(--white);
      border-radius: 16px;
      padding: 25px;
      text-align: center;
      box-shadow: var(--shadow);
      border: none;
      transition: transform 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .dashboard-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(135deg, var(--success-color), #059669);
    }

    .dashboard-card:hover {
      transform: translateY(-3px);
    }

    .dashboard-value {
      font-size: 1.8rem;
      font-weight: 800;
      color: var(--dark-color);
      margin-bottom: 5px;
    }

    .dashboard-label {
      color: var(--success-color);
      font-weight: 600;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .chart-container {
      background: var(--white);
      border-radius: 16px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: var(--shadow);
    }

    .chart-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--success-color);
      margin-bottom: 20px;
      text-align: center;
    }

    .editor-categoria {
      background: var(--light-bg);
      border-radius: 12px;
      padding: 20px;
      margin: 15px 0;
      border: 2px dashed #d1d5db;
    }

    .icon-status {
      font-size: 1.2rem;
    }

    .badge-modern {
      padding: 6px 12px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 0.75rem;
    }

    .input-group-modern {
      display: flex;
      gap: 10px;
      align-items: end;
    }

    .valor-dourado {
      background: #ffffff;
      color: #d4af37;
      font-weight: bold;
      padding: 8px 12px;
      border-radius: 8px;
      text-align: center;
    }

    .valor-total-dourado {
      background: linear-gradient(135deg, #d4af37, #ffd700);
      color: #000000;
      font-weight: bold;
      padding: 15px;
      border-radius: 12px;
      text-align: center;
      margin-top: 15px;
      box-shadow: 0 4px 6px rgba(212, 175, 55, 0.3);
    }

    /* Modal personalizado */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content-custom {
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: var(--shadow-lg);
      max-width: 400px;
      width: 90%;
      text-align: center;
    }

    .modal-title-custom {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--dark-color);
      margin-bottom: 20px;
    }

    .modal-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn-limpar-filtros {
      background: linear-gradient(135deg, #6b7280, #4b5563);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      font-weight: 600;
      font-size: 0.8rem;
      transition: all 0.2s ease;
    }

    .btn-limpar-filtros:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(107, 114, 128, 0.3);
    }

    /* Estilos para m√∫ltiplas sa√≠das */
    .multiplas-saidas-container {
      background: var(--light-bg);
      border-radius: 12px;
      padding: 20px;
      margin-top: 20px;
      border: 2px solid var(--success-color);
      display: none;
    }

    .saida-item {
      background: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      border: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .saida-info {
      flex: 1;
    }

    .saida-actions {
      display: flex;
      gap: 8px;
    }

    .btn-multiplas-container {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    @media (max-width: 768px) {
      .main-container {
        margin: 10px;
        padding: 20px;
        border-radius: 16px;
      }
      
      .dashboard-cards {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
      }
      
      .dashboard-value {
        font-size: 1.4rem;
      }

      .btn-multiplas-container {
        flex-direction: column;
      }

      .chat-examples {
        justify-content: center;
      }

      .chat-bubble {
        max-width: 90%;
      }
    }
  </style>
</head>
<body>
  <div class="main-container">
    <h1 class="header-title" style="display: flex; align-items: center; justify-content: center; position: relative;">
      <span style="margin-right: 15px; font-size: 2.5rem;">üìä</span>
      <span>CONTROLE ICLUB SA√çDAS</span>
      
      <!-- Indicador de status Firebase -->
      <div id="firebaseStatus" style="position: absolute; top: -10px; right: 0; display: flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.1); padding: 8px 12px; border-radius: 20px; font-size: 0.8rem;">
        <div id="statusDot" style="width: 10px; height: 10px; border-radius: 50%; background: #f59e0b; animation: pulse 2s infinite;"></div>
        <span id="statusText">Conectando...</span>
        <button onclick="window.mostrarInstrucoes && window.mostrarInstrucoes()" style="background: none; border: none; color: inherit; cursor: pointer; font-size: 1rem;" title="Instru√ß√µes de configura√ß√£o">
          <i class="fas fa-question-circle"></i>
        </button>
      </div>
    </h1>

    <!-- CHAT IA INTEGRADO - COMPACTO -->
    <div class="chat-ia-container" id="chatContainer">
      <!-- Header compacto clic√°vel -->
      <div class="chat-header" onclick="toggleChat()" style="cursor: pointer;">
        <div class="chat-title">
          <h5>üí¨ IA da iCLUB</h5>
          <small id="chatStatus">Clique para abrir - IA inteligente para adicionar sa√≠das</small>
        </div>
        <div style="display: flex; gap: 10px; align-items: center;">
          <i class="fas fa-chevron-down" id="chatToggleIcon" style="transition: transform 0.3s ease;"></i>
        </div>
      </div>
      
      <!-- Conte√∫do do chat (inicialmente oculto) -->
      <div id="chatContent" style="display: none;">
        <div class="chat-messages" id="chatMessages">
          <div class="chat-message system">
            <div class="chat-bubble">
              <div>üëã Ol√°! Eu sou a IA do iClub. Digite suas sa√≠das agora e eu vou adicionar automatico para voc√™!</div>
              <div class="chat-time">Agora</div>
            </div>
          </div>
        </div>
        
        <div class="typing-indicator" id="typingIndicator">
          <div class="typing-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
          <span>IA processando...</span>
        </div>
        
        <div class="chat-input-container">
          <input type="text" 
                 class="chat-input" 
                 id="chatInput" 
                 placeholder="Ex: Paguei 500 de aluguel hoje..."
                 autocomplete="off"
                 maxlength="200">
          <button class="chat-send-btn" id="chatSendBtn" onclick="window.enviarMensagemChat && window.enviarMensagemChat()">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
        
        <div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center;">
          <button class="btn" style="background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 8px; padding: 6px 12px; font-size: 0.8rem;" onclick="window.limparChat && window.limparChat()">
            <i class="fas fa-trash me-1"></i> Limpar
          </button>
          <button class="btn" style="background: rgba(255,255,255,0.2); color: white; border: none; border-radius: 8px; padding: 6px 12px; font-size: 0.8rem;" onclick="window.mostrarTreinamentoIA && window.mostrarTreinamentoIA()">
            <i class="fas fa-graduation-cap me-1"></i> Treinar IA
          </button>
          <small style="opacity: 0.8; font-size: 0.75rem;">
            üí° IA aprende com voc√™
          </small>
        </div>
      </div>
    </div>

    <!-- Formul√°rio de Cadastro -->
    <div class="card-modern">
      <h5 class="status-title">
        Nova Sa√≠da
      </h5>
      
      <div class="row g-3">
        <div class="col-md-6 col-lg-2">
          <label class="form-label fw-bold">Loja</label>
          <select id="loja" class="form-select"></select>
          <button class="btn btn-outline-secondary btn-sm-modern mt-2 w-100" onclick="mostrarEditorLoja()">
            <i class="fas fa-edit"></i> Editar Lojas
          </button>
        </div>
        <div class="col-md-6 col-lg-2">
          <label class="form-label fw-bold">Centro de custo</label>
          <select id="categoria" class="form-select"></select>
          <button class="btn btn-outline-secondary btn-sm-modern mt-2 w-100" onclick="mostrarEditorCategoria()">
            <i class="fas fa-edit"></i> Editar Centros de custo
          </button>
        </div>
        <div class="col-md-6 col-lg-2">
          <label class="form-label fw-bold">Descri√ß√£o</label>
          <input type="text" id="descricao" class="form-control" placeholder="Digite a descri√ß√£o"/>
        </div>
        <div class="col-md-6 col-lg-2">
          <label class="form-label fw-bold">Valor (R$)</label>
          <input type="text" id="valor" class="form-control" placeholder="R$ 0,00" oninput="formatarMoeda(this)"/>
        </div>
        <div class="col-md-6 col-lg-1">
          <label class="form-label fw-bold">Data</label>
          <input type="date" id="data" class="form-control"/>
        </div>
        <div class="col-md-6 col-lg-1">
          <label class="form-label fw-bold">Recorrente?</label>
          <select id="recorrente" class="form-select" onchange="toggleTipoRecorrencia()">
            <option>N√£o</option>
            <option>Sim</option>
          </select>
        </div>
        <div class="col-md-6 col-lg-1" id="colunaTipoRecorrencia" style="display:none;">
          <label class="form-label fw-bold">Tipo</label>
          <select id="tipoRecorrencia" class="form-select">
            <option disabled selected>Selecione</option>
            <option>Di√°ria</option>
            <option>Semanal</option>
            <option>Mensal</option>
            <option>Anual</option>
          </select>
        </div>
        <div class="col-md-6 col-lg-1">
          <label class="form-label fw-bold">Pago?</label>
          <select id="pago" class="form-select">
            <option>Sim</option>
            <option>N√£o</option>
          </select>
        </div>
        <div class="col-12">
          <div class="btn-multiplas-container">
            <button class="btn btn-success-modern btn-modern flex-fill" onclick="adicionarSaida()">
              <i class="fas fa-plus"></i> Adicionar Sa√≠da
            </button>
            <button class="btn btn-success-modern btn-modern flex-fill" onclick="iniciarMultiplasSaidas()">
              <i class="fas fa-clone"></i> Adicionar M√∫ltiplas Sa√≠das
            </button>
          </div>
          <div id="mensagemSucesso" class="alert alert-success mt-3" style="display:none;">
            ‚úÖ Sa√≠da adicionada!
          </div>
        </div>
      </div>

      <!-- Editor Loja -->
      <div id="editor-loja" class="editor-categoria" style="display:none">
        <div class="input-group-modern">
          <input type="text" id="novaLoja" placeholder="Nova loja" class="form-control"/>
          <button class="btn btn-success-modern btn-modern" onclick="adicionarLoja()">
            Adicionar
          </button>
          <button class="btn btn-warning btn-modern" onclick="mostrarEditorLojaExistente()">
            <i class="fas fa-edit"></i> Editar Lista
          </button>
        </div>
      </div>

      <!-- Editor Categoria -->
      <div id="editor-categoria" class="editor-categoria" style="display:none">
        <div class="input-group-modern">
          <input type="text" id="novaCategoria" placeholder="Novo centro de custo" class="form-control"/>
          <button class="btn btn-success-modern btn-modern" onclick="adicionarCategoria()">
            Adicionar
          </button>
          <button class="btn btn-warning btn-modern" onclick="mostrarEditorCategoriaExistente()">
            <i class="fas fa-edit"></i> Editar Lista
          </button>
        </div>
      </div>

      <!-- Container para M√∫ltiplas Sa√≠das -->
      <div id="multiplasSaidasContainer" class="multiplas-saidas-container">
        <h6 class="mb-3" style="color: var(--success-color); font-weight: 700;">
          <i class="fas fa-list"></i> Lista de Sa√≠das para Adicionar
        </h6>
        <div id="listaSaidas"></div>
        <div class="mt-3">
          <button class="btn btn-success-modern btn-modern me-2" onclick="adicionarNovaLinha()">
            <i class="fas fa-plus"></i> Adicionar Nova Linha
          </button>
          <button class="btn btn-success-modern btn-modern me-2" onclick="adicionarTodasSaidas()">
            <i class="fas fa-save"></i> Adicionar Todas Sa√≠das
          </button>
          <button class="btn btn-secondary btn-modern" onclick="cancelarMultiplasSaidas()">
            <i class="fas fa-times"></i> Cancelar
          </button>
        </div>
      </div>
    </div>

    <!-- Filtro Global por Loja -->
    <div class="card-modern">
      <h5 class="status-title">
        Filtros Gerais
      </h5>
      <div class="row g-2">
        <div class="col-md-12">
          <label class="form-label fw-bold">Visualizar loja:</label>
          <select id="filtroLojaGlobal" class="form-select" onchange="aplicarFiltroLoja()">
            <option value="">üìä Todas as lojas (Consolidado)</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Se√ß√µes de Status -->
    <div class="status-section status-atrasadas">
      <h5 class="status-title">
        Sa√≠das Atrasadas
      </h5>
      <div id="atrasadas"></div>
    </div>

    <div class="status-section status-vencendo">
      <h5 class="status-title">
        Sa√≠das Vencendo Hoje
      </h5>
      <div id="vencendoHoje"></div>
    </div>

    <div class="status-section status-proximas">
      <h5 class="status-title">
        Pr√≥ximas Sa√≠das a Vencer
      </h5>
      <div id="proximas"></div>
    </div>

    <div class="status-section status-recorrentes">
      <h5 class="status-title">
        Sa√≠das Recorrentes
      </h5>
      <div class="row g-2 mb-3">
        <div class="col-md-3">
          <label class="form-label fw-bold">Filtrar por loja:</label>
          <select id="filtroLojaRecorrentes" class="form-select" onchange="filtrarRecorrentesPorFiltros()">
            <option value="">Todas as lojas</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label fw-bold">Filtrar por ano:</label>
          <select id="filtroAnoRecorrentes" class="form-select" onchange="preencherMesesDoAno()">
            <option value="">Todos os anos</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label fw-bold">Filtrar por m√™s:</label>
          <select id="filtroMesRecorrentes" class="form-select" onchange="filtrarRecorrentesPorFiltros()">
            <option value="">Todos os meses</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label fw-bold">Filtrar por centro de custo:</label>
          <div class="d-flex gap-2">
            <select id="filtroCategoriaRecorrentes" class="form-select" onchange="filtrarRecorrentesPorFiltros()">
              <option value="">Todos os centros de custo</option>
            </select>
            <button class="btn btn-limpar-filtros" onclick="limparFiltrosRecorrentes()" title="Limpar Filtros">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
      </div>
      <div id="previsaoRecorrentes"></div>
      <div class="valor-total-dourado">
        <strong>Valor total sa√≠das: <span id="totalSaidasRecorrentes">R$ 0,00</span></strong>
      </div>
    </div>

    <!-- Sa√≠das do M√™s -->
    <div class="card-modern">
      <h4 class="status-title">
        Sa√≠das do M√™s
      </h4>
      <div class="table-responsive">
        <table class="table table-modern">
          <thead>
            <tr>
              <th>Loja</th>
              <th>Centro de custo</th>
              <th>Descri√ß√£o</th>
              <th>Valor</th>
              <th>Data</th>
              <th>Recorrente</th>
              <th>Tipo</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="tabelaSaidas"></tbody>
        </table>
      </div>
    </div>

    <!-- Sa√≠das Atrasadas -->
    <div class="card-modern">
      <h4 class="status-title">
        üö® Sa√≠das Atrasadas
      </h4>
      <div class="table-responsive">
        <table class="table table-modern">
          <thead>
            <tr>
              <th>Loja</th>
              <th>Centro de custo</th>
              <th>Descri√ß√£o</th>
              <th>Valor</th>
              <th>Data</th>
              <th>Dias Atrasado</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="tabelaAtrasadas"></tbody>
        </table>
      </div>
    </div>

    <!-- Sa√≠das Pr√≥ximas ao Vencimento -->
    <div class="card-modern">
      <h4 class="status-title">
        ‚è∞ Pr√≥ximas ao Vencimento
      </h4>
      <div class="table-responsive">
        <table class="table table-modern">
          <thead>
            <tr>
              <th>Loja</th>
              <th>Centro de custo</th>
              <th>Descri√ß√£o</th>
              <th>Valor</th>
              <th>Data</th>
              <th>Dias Restantes</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="tabelaProximas"></tbody>
        </table>
      </div>
    </div>

    <!-- Dashboard -->
    <div class="card-modern">
      <h4 class="status-title">
        Dashboard total sa√≠das do m√™s
      </h4>
      <div class="dashboard-cards">
        <div class="dashboard-card">
          <div class="dashboard-value" id="totalMes">R$ 0,00</div>
          <div class="dashboard-label">Total do M√™s</div>
        </div>
        <div class="dashboard-card">
          <div class="dashboard-value" id="totalRecorrente">R$ 0,00</div>
          <div class="dashboard-label">Total Recorrente</div>
        </div>
        <div class="dashboard-card">
          <div class="dashboard-value" id="maiorGasto">R$ 0,00</div>
          <div class="dashboard-label">Maior Gasto</div>
        </div>
        <div class="dashboard-card">
          <div class="dashboard-value" id="categoriaTopo">-</div>
          <div class="dashboard-label">Centro de custo Topo</div>
        </div>
        <div class="dashboard-card">
          <div class="dashboard-value" id="totalSaidas">0</div>
          <div class="dashboard-label">Total de Sa√≠das</div>
        </div>
      </div>
    </div>

    <!-- Comparativo entre Lojas -->
    <div class="card-modern" id="comparativoLojas">
      <h4 class="status-title">
        üìä Comparativo entre Lojas
      </h4>
      <div id="tabelaComparativo"></div>
      
      <!-- Gr√°fico Comparativo de Lojas -->
      <div class="chart-container mt-4">
        <h4 class="chart-title">
          Gr√°fico Comparativo por Loja
        </h4>
        <div class="d-flex justify-content-center align-items-center">
          <div style="width: 600px; height: 400px;">
            <canvas id="graficoLojas"></canvas>
          </div>
        </div>
      </div>
      
      <!-- Gr√°fico Centros de Custo por Loja -->
      <div class="chart-container mt-4">
        <h4 class="chart-title">
          Gr√°fico de Centros de Custo por Loja
        </h4>
        <div class="d-flex justify-content-center align-items-center">
          <div style="width: 700px; height: 400px;">
            <canvas id="graficoCentrosCusto"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Gr√°ficos -->
    <div class="chart-container">
      <h4 class="chart-title">
        Gr√°fico por Centro de custo
      </h4>
      <div class="d-flex justify-content-center align-items-center">
        <div style="width: 400px; height: 400px;">
          <canvas id="graficoCategoria"></canvas>
        </div>
      </div>
    </div>

    <div class="chart-container">
      <h4 class="chart-title">
        Gr√°fico por Tipo de Gasto
      </h4>
      <div class="d-flex justify-content-center align-items-center">
        <div style="width: 400px; height: 400px;">
          <canvas id="graficoTipo"></canvas>
        </div>
      </div>
    </div>

    <div class="chart-container">
      <h4 class="chart-title">
        Gr√°fico de Sa√≠das por M√™s
      </h4>
      <div class="d-flex justify-content-center align-items-center">
        <div style="width: 600px; height: 400px;">
          <canvas id="graficoMes"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal personalizado -->
  <div id="modalCustom" class="modal-overlay" style="display: none;">
    <div class="modal-content-custom">
      <div class="modal-title-custom" id="modalTitulo">T√≠tulo do Modal</div>
      <div id="modalTexto" style="margin-bottom: 20px;"></div>
      <div class="modal-buttons" id="modalBotoes">
        <!-- Bot√µes ser√£o inseridos aqui -->
      </div>
    </div>
  </div>

  <script type="module" src="painel.js"></script>
  <script>
    // Vari√°veis globais para gr√°ficos
    window.chartCategoria = null;
    window.chartTipo = null;
    window.chartLojas = null;
    window.graficoCentrosCusto = null;
    window.graficoMes = null;

    // Fun√ß√£o para toggle do chat
    function toggleChat() {
      const content = document.getElementById('chatContent');
      const icon = document.getElementById('chatToggleIcon');
      const status = document.getElementById('chatStatus');
      
      if (content.style.display === 'none') {
        content.style.display = 'block';
        icon.style.transform = 'rotate(180deg)';
        status.textContent = 'IA inteligente para adicionar sa√≠das';
        
        // Focar no input quando abrir
        setTimeout(() => {
          const chatInput = document.getElementById('chatInput');
          if (chatInput) chatInput.focus();
        }, 100);
      } else {
        content.style.display = 'none';
        icon.style.transform = 'rotate(0deg)';
        status.textContent = 'Clique para abrir - IA inteligente para adicionar sa√≠das';
      }
    }

    // Garantir que fun√ß√µes globais funcionem
    window.addEventListener('DOMContentLoaded', function() {
      // Configurar data padr√£o
      const dataElement = document.getElementById('data');
      if (dataElement && !dataElement.value) {
        dataElement.value = new Date().toISOString().split('T')[0];
      }
      
      // Event listener para Enter no chat
      const chatInput = document.getElementById('chatInput');
      if (chatInput) {
        chatInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            if (typeof window.enviarMensagemChat === 'function') {
              window.enviarMensagemChat();
            }
          }
        });
      }
      
      // Exportar fun√ß√£o toggle para window
      window.toggleChat = toggleChat;
      
      // Exportar fun√ß√£o treinar IA
      window.mostrarTreinamentoIA = function() {
        const modal = document.getElementById('modalCustom');
        if (modal) {
          document.getElementById('modalTitulo').textContent = 'üéì Treinar IA do iClub';
          document.getElementById('modalTexto').innerHTML = `
            <div style="text-align: left;">
              <p><strong>Ensine a IA a reconhecer suas sa√≠das:</strong></p>
              <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
                <strong>Exemplo:</strong><br>
                üìù Frase: "Paguei 500 de aluguel"<br>
                üè∑Ô∏è Categoria: "Aluguel"<br>
                üìã Descri√ß√£o: "Aluguel"
              </div>
              <p><strong>üí° Dicas para treinar:</strong></p>
              <ul>
                <li>Use palavras-chave claras</li>
                <li>Seja consistente nos termos</li>
                <li>A IA aprende com o tempo</li>
                <li>Teste diferentes varia√ß√µes</li>
              </ul>
              <p><strong>üöÄ Funcionalidades Avan√ßadas:</strong></p>
              <ul>
                <li>M√∫ltiplas sa√≠das: "aluguel 2.000 de castanhal, belem e mix"</li>
                <li>Detec√ß√£o autom√°tica de valores e datas</li>
                <li>Perguntas inteligentes se faltar informa√ß√£o</li>
              </ul>
            </div>
          `;
          document.getElementById('modalBotoes').innerHTML = `
            <button class="btn btn-primary" onclick="fecharModal()">Entendi!</button>
          `;
          modal.style.display = 'flex';
        }
      };
      
      console.log('‚úÖ HTML carregado e configurado');
    });

    // Fun√ß√£o de debug para verificar dados
    window.debugSistema = function() {
      console.log('üîç DEBUG SISTEMA:');
      console.log('Firebase inicializado:', window.firebaseInicializado || false);
      console.log('Sa√≠das carregadas:', window.saidas?.length || 0);
      console.log('Sa√≠das pendentes:', window.saidasPendentes?.length || 0);
      console.log('Categorias:', window.categorias?.length || 0);
      console.log('Lojas:', window.lojas?.length || 0);
      
      // Verificar localStorage
      const dadosLocal = localStorage.getItem('iclubSaidas');
      if (dadosLocal) {
        const dados = JSON.parse(dadosLocal);
        console.log('Backup local:', dados.totalSaidas || 0, 'sa√≠das');
      } else {
        console.log('Nenhum backup local encontrado');
      }
    };

    // Mostrar instru√ß√µes de configura√ß√£o
    window.mostrarInstrucoes = function() {
      alert(`üìã INSTRU√á√ïES DE CONFIGURA√á√ÉO:

1. üî• Configure Firebase:
   - Acesse: https://console.firebase.google.com
   - Crie projeto ou selecione existente
   - Ative Firestore Database
   - Copie configura√ß√µes para painel.js

2. üìä Configure regras Firestore:
   rules_version = '2';
   service cloud.firestore {
     match /databases/{database}/documents {
       match /{document=**} {
         allow read, write: if true;
       }
     }
   }

3. üß™ Teste o sistema:
   - Digite no chat: "2000 aluguel"
   - Abra outro navegador
   - Dados devem sincronizar

Para debug: digite debugSistema() no console`);
    };

    // Auto-mostrar instru√ß√µes se Firebase n√£o configurado
    setTimeout(() => {
      if (!window.firebaseInicializado) {
        console.warn('‚ö†Ô∏è Firebase n√£o configurado. Digite mostrarInstrucoes() para ajuda.');
      }
    }, 5000);
  </script>
</body>
</html>